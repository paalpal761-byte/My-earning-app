<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earning App</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.unityads.unity3d.com/sdk/4.0.0/unity-ads-sdk.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f4f4f4; }
        .card { background: white; margin: 20px; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .btn { background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; width: 80%; font-size: 18px; }
        input { padding: 10px; width: 75%; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; }
    </style>
</head>
<body>

<div id="login-section">
    <h2>Secure Login</h2>
    <div class="card">
        <input type="text" id="phone" placeholder="+91 9876543210">
        <div id="recaptcha-container"></div>
        <button class="btn" onclick="sendOTP()" id="send-btn">Send OTP</button>
        <div id="otp-div" style="display:none; margin-top:10px;">
            <input type="number" id="otp" placeholder="6 Digit OTP">
            <button class="btn" style="background:#007bff;" onclick="verifyOTP()">Verify OTP</button>
        </div>
    </div>
</div>

<div id="main-app" style="display:none;">
    <h2>Dashboard</h2>
    <div class="card">
        <p>Balance: ₹<span id="user-balance">0.00</span></p>
        <button class="btn" onclick="watchAd()">Watch Video (₹0.10)</button>
    </div>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDsvE6RNfQpr8X9F7dR3T735lh3hd17Vb8",
    authDomain: "my-earning-app-78540.firebaseapp.com",
    databaseURL: "https://my-earning-app-78540-default-rtdb.firebaseio.com",
    projectId: "my-earning-app-78540",
    storageBucket: "my-earning-app-78540.appspot.com",
    messagingSenderId: "646826042515",
    appId: "1:646826042515:web:a68a3bf1c28480e691966"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const database = firebase.database();

// Unity Ads Start
unityads.UnityAds.initialize("6042395", true);

window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', { 'size': 'invisible' });

function sendOTP() {
    const phoneNumber = document.getElementById('phone').value;
    if(!phoneNumber.includes('+91')) return alert("Number +91 ke saath daalein");
    
    auth.signInWithPhoneNumber(phoneNumber, window.recaptchaVerifier)
        .then((result) => {
            confirmationResult = result;
            document.getElementById('otp-div').style.display = 'block';
            alert("OTP bhej diya gaya hai!");
        }).catch((err) => alert("Error: " + err.message));
}

function verifyOTP() {
    const code = document.getElementById('otp').value;
    window.confirmationResult.confirm(code).then((result) => {
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        loadUserData(result.user.uid);
    }).catch((err) => alert("OTP galat hai!"));
}

function loadUserData(uid) {
    database.ref('users/' + uid).on('value', (snap) => {
        const val = snap.val() || { balance: 0 };
        document.getElementById('user-balance').innerText = val.balance.toFixed(2);
    });
}

function watchAd() {
    unityads.UnityAds.show("Rewarded_Android", {
        onComplete: () => {
            const userRef = database.ref('users/' + auth.currentUser.uid);
            userRef.once('value').then((snap) => {
                const bal = snap.val() ? snap.val().balance : 0;
                userRef.update({ balance: bal + 0.10 });
                alert("₹0.10 mil gaye!");
            });
        },
        onFailed: (err) => alert("Ad load nahi hua, rukiye...")
    });
}
</script>
</body>
</html>
